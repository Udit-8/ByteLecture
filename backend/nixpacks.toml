# Nixpacks configuration for Railway deployment

[phases.setup]
# System and build dependencies (canvas, ffmpeg, yt-dlp)
apkPkgs = [
  "ffmpeg",
  "curl",
  "python3",
  "py3-pip",
  "build-base",
  "cairo-dev",
  "pango-dev",
  "libjpeg-turbo-dev",
  "giflib-dev",
  "pixman-dev",
  "pkgconf"
]

[phases.install]
cmds = [
  # Install Node deps without dev packages for prod
  "npm ci --omit=dev",

  # Install yt-dlp via pip (more reliable with Alpine Python)
  "pip3 install --break-system-packages yt-dlp"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "npm start"

[variables]
NODE_ENV = "production"
NIXPACKS_NODE_VERSION = "22"